<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 11 Desktop Simulation (Fixed Dragging & Terminal Controls)</title>
    <style>
        :root {
            --win-bg: #f3f3f3;
            --taskbar-bg: rgba(32, 32, 32, 0.85);
            --window-bg: #0c0c0c;
            --explorer-bg: #1f1f1f;
            --explorer-sidebar: #2b2b2b;
            --hover-bg: rgba(255, 255, 255, 0.08);
            --selected-bg: rgba(255, 255, 255, 0.2);
            --accent-color: #0078D4;
        }

        * {
            box-sizing: border-box;
            user-select: none;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* 桌面背景 */
        .desktop {
            width: 100%; height: 100%; position: relative;
            background: url('https://picsum.photos/1920/1080/') no-repeat center center/cover;
        }

        /* 桌面圖示區域 */
        .desktop-icons-area {
            position: absolute; top: 10px; left: 10px; display: flex;
            flex-direction: column; gap: 4px; z-index: 1;
            color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        }

        .d-icon {
            width: 76px; height: 90px; display: flex; flex-direction: column;
            align-items: center; justify-content: flex-start; padding: 5px;
            border: 1px solid transparent; border-radius: 4px; cursor: default;
            transition: background 0.1s;
        }

        .d-icon:hover { background-color: rgba(255, 255, 255, 0.1); }
        .d-icon.selected { background-color: var(--selected-bg); border-color: rgba(255, 255, 255, 0.1); }
        .d-icon svg { width: 40px; height: 40px; margin-bottom: 4px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
        .d-icon span { font-size: 12px; text-align: center; line-height: 1.2; overflow: hidden; }

        /* --- 視窗通用樣式 --- */
        .sim-window {
            min-width: 400px; 
            min-height: 300px; 
            width: 80%; max-width: 1000px; height: 70%; max-height: 700px;
            background-color: var(--window-bg); border: 1px solid #333;
            border-radius: 8px; box-shadow: 0 0 0 1px rgba(0,0,0,0.2), 0 20px 50px rgba(0,0,0,0.6);
            display: flex; flex-direction: column; overflow: hidden;
            position: absolute; 
            top: 50%; left: 50%; transform: translate(-50%, -50%); 
            z-index: 10;
            transition: all 0.2s ease-in-out; 
        }
        
        /* 放大樣式 */
        .sim-window.maximized {
            width: 100% !important;
            height: calc(100% - 48px) !important; 
            top: 0 !important;
            left: 0 !important;
            transform: none !important;
            border-radius: 0;
            box-shadow: none;
        }

        .title-bar {
            height: 32px; background-color: #1f1f1f; display: flex;
            justify-content: space-between; align-items: center; color: #fff;
            font-size: 12px; padding-left: 12px; cursor: grab;
        }
        .title-bar:active { cursor: grabbing; }

        /* 終端機控制項樣式（顯示但無功能）*/
        #terminal-window .title-bar {
            justify-content: space-between; /* 確保控制鈕在右邊 */
        }
        /* 移除上一次隱藏終端機控制項的 CSS */
        
        .window-controls { display: flex; height: 100%; }
        .control-btn {
            width: 46px; height: 100%; display: flex;
            justify-content: center; align-items: center; transition: 0.2s;
            cursor: default;
        }
        .control-btn:hover { background-color: #333; }
        .control-btn.close:hover { background-color: #e81123; }
        
        /* 終端機特有 */
        .terminal-content { flex: 1; width: 100%; background-color: #000; }
        .terminal-content iframe { width: 100%; height: 100%; border: none; display: block; }
        
        /* 縮放手柄 (右下角) */
        .resize-handle {
            position: absolute; bottom: 0; right: 0; width: 10px; height: 10px;
            cursor: nwse-resize; z-index: 11;
        }

        /* 檔案總管/資源回收桶特有 */
        #window-this-pc { background-color: var(--explorer-bg); }
        .explorer-content { flex: 1; display: flex; flex-direction: column; background-color: var(--explorer-bg); color: white; }
        .explorer-header { padding: 10px; border-bottom: 1px solid #444; }
        .explorer-main { display: flex; flex: 1; }
        .explorer-sidebar { width: 200px; padding: 10px; background-color: var(--explorer-sidebar); font-size: 14px; }
        .explorer-view { flex: 1; padding: 15px; overflow-y: auto; }
        .drive-container { display: flex; flex-wrap: wrap; gap: 20px; }
        .drive-item { 
            width: 150px; padding: 10px; border-radius: 4px; cursor: pointer; 
            transition: background 0.1s; display: flex; flex-direction: column;
            align-items: center; text-align: center;
        }
        .drive-item:hover { background-color: rgba(255, 255, 255, 0.1); }
        .drive-item svg { width: 50px; height: 50px; margin-bottom: 5px; }
        .drive-item span { font-size: 13px; }
        .drive-item p { font-size: 11px; opacity: 0.7; margin: 2px 0 0; }
        
        /* 工作列 */
        .taskbar {
            position: absolute; bottom: 0; width: 100%; height: 48px;
            background: var(--taskbar-bg); backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px); border-top: 1px solid rgba(255, 255, 255, 0.08);
            display: grid; grid-template-columns: 1fr auto 1fr; align-items: center;
            padding: 0 12px; z-index: 100;
        }

        .taskbar-center { display: flex; gap: 6px; height: 100%; align-items: center; justify-content: center; }
        .app-icon {
            width: 40px; height: 40px; border-radius: 4px; display: flex;
            justify-content: center; align-items: center; transition: background 0.1s;
            cursor: pointer; position: relative;
        }

        .app-icon:hover { background-color: var(--hover-bg); }
        .app-icon.active { background-color: var(--hover-bg); }
        .app-icon.active::after {
            content: ''; position: absolute; bottom: 0; width: 16px; height: 3px;
            background: #60cdff; border-radius: 2px;
        }
        .app-icon svg { width: 24px; height: 24px; }
        .taskbar-right { display: flex; justify-content: flex-end; align-items: center; gap: 8px; height: 100%; color: white;}
        .tray-btn { height: 80%; border-radius: 4px; padding: 0 8px; display: flex; align-items: center; transition: background 0.1s; cursor: pointer; }
        .tray-btn:hover { background-color: var(--hover-bg); }
        .tray-group { display: flex; align-items: center; gap: 10px; padding: 0 10px; }
        .tray-group svg { width: 18px; height: 18px; fill: white; }
        .tray-clock { display: flex; flex-direction: column; align-items: flex-end; justify-content: center; font-size: 12px; line-height: 1.3; padding: 0 10px; min-width: 70px; }
        .show-desktop-line { width: 4px; height: 60%; border-left: 1px solid rgba(255,255,255,0.3); margin-left: 8px; }

        /* 開始選單樣式 */
        #start-menu-panel {
            position: absolute;
            bottom: 58px;
            left: 50%;
            width: 500px;
            height: 600px;
            background: rgba(32, 32, 32, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding: 15px;
            display: flex;
            flex-direction: column;
            color: white;
            z-index: 90;
            /* For animation */
            transform: translate(-50%, 10px);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease-out, transform 0.2s ease-out, visibility 0.2s;
        }

        #start-menu-panel.show {
            opacity: 1;
            transform: translate(-50%, 0);
            visibility: visible;
        }

        .start-menu-section { margin-bottom: 20px; }
        .start-menu-section h4 { font-weight: 600; font-size: 16px; margin-bottom: 10px; opacity: 0.8; }
        .pinned-apps, .recommended-items { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; }
        .pinned-app-item { display: flex; flex-direction: column; align-items: center; padding: 8px 0; border-radius: 4px; cursor: pointer; transition: background 0.1s; }
        .pinned-app-item:hover { background-color: rgba(255, 255, 255, 0.1); }
        .pinned-app-item span { font-size: 11px; margin-top: 4px; }
        .pinned-app-item svg { width: 20px; height: 20px; }
        .sm-footer {
            display: flex; justify-content: space-between; align-items: center;
            padding-top: 10px; border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .sm-profile { display: flex; align-items: center; gap: 10px; font-size: 14px; cursor: pointer; }
        .sm-profile-icon { width: 30px; height: 30px; background: #666; border-radius: 50%; }
        .sm-power button { background: none; border: none; color: white; cursor: pointer; padding: 5px; border-radius: 4px; }
        .sm-power button:hover { background-color: rgba(255, 255, 255, 0.1); }

    </style>
</head>
<body>

<div class="desktop">
    
    <div class="desktop-icons-area">
        <div class="d-icon" id="icon-this-pc" onclick="selectIcon(this)" ondblclick="openWindow('window-this-pc', '本機')">
            <svg viewBox="0 0 24 24" fill="none">
                <rect x="2" y="4" width="20" height="12" rx="1" stroke="#fff" stroke-width="2"/>
                <path d="M6 16h12M12 16v4M8 20h8" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span>本機</span>
        </div>
        <div class="d-icon" id="icon-recycle-bin" onclick="selectIcon(this)" ondblclick="openWindow('window-recycle-bin', '資源回收桶')">
            <svg viewBox="0 0 24 24" fill="none">
                <path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14z" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <line x1="10" y1="11" x2="10" y2="17" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
                <line x1="14" y1="11" x2="14" y2="17" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span>資源回收桶</span>
        </div>
        <div class="d-icon" onclick="selectIcon(this)">
            <svg viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z" fill="none"/>
                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" fill="#00A4EF"/>
            </svg>
            <span>Microsoft Edge</span>
        </div>
    </div>

    <div class="sim-window" id="terminal-window">
        <div class="title-bar" id="title-bar-terminal">
            <div class="title-text">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <rect x="2" y="3" width="12" height="10" rx="1" stroke="white" stroke-width="1"/>
                    <path d="M4.5 6L6.5 8L4.5 10" stroke="white" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8 10H11.5" stroke="white" stroke-width="1" stroke-linecap="round"/>
                </svg>
                <span>Administrator: Windows PowerShell</span>
            </div>
            <div class="window-controls">
                <div class="control-btn"><svg width="10" height="1" viewBox="0 0 10 1"><rect width="10" height="1" fill="white"/></svg></div>
                <div class="control-btn">
                    <svg width="10" height="10" viewBox="0 0 10 10">
                        <path d="M1 1h8v8H1V1z" fill="none" stroke="white" stroke-width="1"/>
                    </svg>
                </div>
                <div class="control-btn close"><svg width="10" height="10" viewBox="0 0 10 10"><path d="M1 1L9 9M9 1L1 9" stroke="white" stroke-width="1"/></svg></div>
            </div>
        </div>
        <div class="terminal-content">
            <iframe src="https://svenstaro.github.io/genact/" title="Genact Terminal"></iframe>
        </div>
    </div>

    <div class="sim-window" id="window-this-pc" style="display: none; width: 850px; height: 550px;">
        <div class="title-bar" id="title-bar-this-pc" style="background-color: var(--accent-color); color: white; cursor: grab;">
            <div class="title-text">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="white"><rect x="2" y="4" width="20" height="12" rx="1"/><path d="M6 16h12M12 16v4M8 20h8" /></svg>
                <span>本機</span>
            </div>
            <div class="window-controls">
                <div class="control-btn" onclick="minimizeWindow('window-this-pc')"><svg width="10" height="1" viewBox="0 0 10 1"><rect width="10" height="1" fill="white"/></svg></div>
                <div class="control-btn" onclick="toggleMaximize('window-this-pc')"><svg width="10" height="10" viewBox="0 0 10 10"><rect x="1" y="1" width="8" height="8" stroke="white" fill="none" stroke-width="1"/></svg></div>
                <div class="control-btn close" onclick="closeWindow('window-this-pc')"><svg width="10" height="10" viewBox="0 0 10 10"><path d="M1 1L9 9M9 1L1 9" stroke="white" stroke-width="1"/></svg></div>
            </div>
        </div>
        <div class="explorer-content">
            <div class="explorer-header">
                <span style="font-size: 14px; opacity: 0.8;">此電腦 ></span>
            </div>
            <div class="explorer-main">
                <div class="explorer-sidebar">
                    <p>快速存取</p>
                    <p style="opacity: 0.6; margin-left: 10px;">桌面<br>下載<br>文件</p>
                </div>
                <div class="explorer-view">
                    <h4 style="margin-top: 0; font-weight: 500;">裝置與磁碟</h4>
                    <div class="drive-container">
                        <div class="drive-item">
                            <svg viewBox="0 0 24 24" fill="#60cdff">
                                <path d="M20 18H4V8h16v10zm-1-8H5v8h14v-8zM7 16h3v-2H7v2zm8-2h3v-2h-3v2z"/>
                                <rect x="3" y="6" width="18" height="2" rx="1" fill="#60cdff"/>
                            </svg>
                            <span>Windows (C:)</span>
                            <p>50 GB 可用，共 120 GB</p>
                        </div>
                        <div class="drive-item">
                            <svg viewBox="0 0 24 24" fill="#888">
                                <path d="M20 18H4V8h16v10zm-1-8H5v8h14v-8zM7 16h3v-2H7v2zm8-2h3v-2h-3v2z"/>
                                <rect x="3" y="6" width="18" height="2" rx="1" fill="#888"/>
                            </svg>
                            <span>資料 (D:)</span>
                            <p>150 GB 可用，共 500 GB</p>
                        </div>
                        <div class="drive-item">
                            <svg viewBox="0 0 24 24" fill="#f8d800">
                                <path d="M18 6h-2V4h-4v2h-2v2h8V6zM4 10v8h16v-8H4zm14 6H6v-4h12v4z"/>
                            </svg>
                            <span>USB 裝置 (E:)</span>
                            <p>30 GB 可用，共 64 GB</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="resize-handle" id="resize-handle-this-pc"></div>
    </div>

    <div class="sim-window" id="window-recycle-bin" style="display: none; width: 600px; height: 400px; background-color: var(--explorer-bg);">
        <div class="title-bar" id="title-bar-recycle-bin" style="background-color: #555; cursor: grab;">
            <div class="title-text">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="white"><path d="M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2m3 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6h14z"/></svg>
                <span>資源回收桶</span>
            </div>
            <div class="window-controls">
                <div class="control-btn" onclick="minimizeWindow('window-recycle-bin')"><svg width="10" height="1" viewBox="0 0 10 1"><rect width="10" height="1" fill="white"/></svg></div>
                <div class="control-btn" onclick="toggleMaximize('window-recycle-bin')"><svg width="10" height="10" viewBox="0 0 10 10"><rect x="1" y="1" width="8" height="8" stroke="white" fill="none" stroke-width="1"/></svg></div>
                <div class="control-btn close" onclick="closeWindow('window-recycle-bin')"><svg width="10" height="10" viewBox="0 0 10 10"><path d="M1 1L9 9M9 1L1 9" stroke="white" stroke-width="1"/></svg></div>
            </div>
        </div>
        <div class="explorer-content">
             <div class="explorer-main">
                <div class="explorer-view" style="padding: 15px;">
                    <h4 style="margin-top: 0; font-weight: 500;">已刪除的檔案</h4>
                    <p style="opacity: 0.8;">這裡目前沒有項目。</p>
                </div>
            </div>
        </div>
    </div>

    <div id="start-menu-panel">
        <div class="start-menu-section">
            <h4>已釘選</h4>
            <div class="pinned-apps">
                <div class="pinned-app-item">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="#00A4EF"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" fill="#00A4EF"/></svg>
                    <span>Edge</span>
                </div>
                <div class="pinned-app-item">
                    <svg viewBox="0 0 24 24" fill="white"><path d="M21 15c0 1.1-.9 2-2 2H7l-4 4V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2z"/></svg>
                    <span>Chat</span>
                </div>
                <div class="pinned-app-item">
                    <svg viewBox="0 0 24 24" fill="white"><path d="M2 12C2 6.48 6.48 2 12 2s10 4.48 10 10-4.48 10-10 10S2 17.52 2 12zm10-5c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm-2 9c-.27 0-.54-.03-.8-.08-1.5-.24-2.88-.84-4.03-1.68C4.55 14.54 4 13.56 4 12c0-1.79 1.47-3.26 3.49-3.92C8.5 7.6 10.15 7 12 7c1.85 0 3.5.6 4.51 1.08C18.53 8.74 20 10.21 20 12c0 1.56-.55 2.54-1.17 3.24-1.15.84-2.53 1.44-4.03 1.68-.26.05-.53.08-.8.08z"/></svg>
                    <span>Teams</span>
                </div>
                <div class="pinned-app-item">
                    <svg viewBox="0 0 24 24" fill="white"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                    <span>PowerShell</span>
                </div>
                <div class="pinned-app-item">
                     <svg viewBox="0 0 24 24" fill="none" stroke="#FCD116" stroke-width="2">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" fill="#FFE082" stroke="none"></path>
                    </svg>
                    <span>File Explorer</span>
                </div>
                <div class="pinned-app-item">
                    <svg viewBox="0 0 24 24" fill="white"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                    <span>Clock</span>
                </div>
            </div>
        </div>

        <div class="start-menu-section">
            <h4>建議</h4>
            <div class="recommended-items">
                <div class="pinned-app-item"><span>.NET Project.sln</span></div>
                <div class="pinned-app-item"><span>Monthly Report.pdf</span></div>
                <div class="pinned-app-item"><span>VScode</span></div>
            </div>
        </div>
        
        <div class="sm-footer">
            <div class="sm-profile">
                <div class="sm-profile-icon"></div>
                <span>Keanu Reeves</span>
            </div>
            <div class="sm-power">
                <button title="Power Options">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="white"><path d="M13 3h-2v10h2V3zm4.5 13.5c-1.34 0-2.5-.59-3.26-1.5l-1.4 1.41c.96 1.05 2.37 1.99 4.66 1.99 3.09 0 5.5-2.51 5.5-5.5s-2.41-5.5-5.5-5.5c-2.14 0-4.03 1.34-4.8 3.32L9.27 12c.57-2.3 2.87-4 5.23-4 3.03 0 5.5 2.47 5.5 5.5s-2.47 5.5-5.5 5.5z"/></svg>
                </button>
            </div>
        </div>
    </div>

    <div class="taskbar">
        <div class="taskbar-left"></div>
        <div class="taskbar-center">
            <div class="app-icon" id="start-button">
                <svg viewBox="0 0 24 24">
                    <path d="M3 11.5h8.5v-9H3v9zm9.5-9v9H21v-9h-8.5zm-9.5 10h8.5v9H3v-9zm9.5 0v9H21v-9h-8.5z" fill="#00a4ef"/>
                </svg>
            </div>
            <div class="app-icon"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round"><circle cx="11" cy="11" r="7"></circle><line x1="21" y1="21" x2="16" y2="16"></line></svg></div>
            <div class="app-icon"><svg viewBox="0 0 24 24" fill="white" fill-opacity="0.8"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1" opacity="0.5"/><rect x="3" y="14" width="7" height="7" rx="1" opacity="0.5"/><rect x="14" y="14" width="7" height="7" rx="1" opacity="0.5"/></svg></div>
            <div class="app-icon active" id="taskbar-terminal-icon">
                <svg viewBox="0 0 24 24" fill="none">
                    <rect x="3" y="4" width="18" height="16" rx="2" fill="black" stroke="white" stroke-width="1"/>
                    <path d="M6 10 L8 12 L6 14" stroke="lightgray" stroke-width="1.5" stroke-linecap="round"/>
                    <line x1="8.5" y1="12" x2="16" y2="12" stroke="lightgray" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M3 5.5 C 5 4 19 4 21 5.5" stroke="rgba(255, 255, 255, 0.4)" stroke-width="1.5"/>
                </svg>
            </div>
        </div>
        <div class="taskbar-right">
            <div class="tray-btn tray-arrow"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg></div>
            <div class="tray-btn" style="font-size:12px; padding: 0 4px;"><span>中</span></div>
            <div class="tray-btn tray-group">
                <svg viewBox="0 0 24 24"><path d="M12.01 21.49L23.64 7c-.45-.34-4.93-4-11.64-4C5.28 3 .81 6.66.36 7l11.63 14.49.01.01.01-.01z" fill="white"/></svg>
                <svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" fill="white"/></svg>
                <svg viewBox="0 0 24 24"><path d="M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4z" fill="white"/></svg>
            </div>
            <div class="tray-btn tray-clock">
                <div id="clock-time">--:--</div>
                <div id="clock-date">----/--/--</div>
            </div>
            <div class="show-desktop-line"></div>
        </div>
    </div>
</div>

<script>
    let zIndexCounter = 100;
    
    const windowStates = {};

    /**
     * 使視窗可拖曳。
     * 透過在拖曳時禁用 CSS transition，並在拖曳結束後恢復，來實現流暢的拖曳效果。
     * 同時處理從 transform 置中到 top/left 定位的切換，避免視窗跳動。
     */
    function makeDraggable(element, dragHandle) {
        let startX, startY, startLeft, startTop;

        dragHandle.onmousedown = function(e) {
            // 忽略控制按鈕的點擊，且不允許拖曳最大化的視窗
            if (e.target.closest('.window-controls') || element.classList.contains('maximized')) {
                return;
            }
            
            e.preventDefault(); // 防止拖曳時意外選取文字

            const rect = element.getBoundingClientRect();
            
            element.style.zIndex = ++zIndexCounter;

            // 為了平滑拖曳，暫時禁用 CSS transition
            element.style.transition = "none"; 

            // 如果視窗是透過 transform 置中，切換到 top/left 定位以方便拖曳
            element.style.left = rect.left + "px";
            element.style.top = rect.top + "px";
            element.style.transform = "none";
            
            // 記錄初始位置
            startX = e.clientX;
            startY = e.clientY;
            startLeft = rect.left;
            startTop = rect.top;

            // 註冊滑鼠移動和放開的事件監聽器
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        };

        function onMouseMove(e) {
            // 計算滑鼠移動的距離
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            // 更新視窗位置
            element.style.left = (startLeft + dx) + "px";
            element.style.top = (startTop + dy) + "px";
        }

        function onMouseUp() {
            // 拖曳結束後，恢復原有的 CSS transition
            element.style.transition = ""; 
            
            // 移除事件監聽器，避免不必要的計算
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
        }
    }


    // 視窗操作函數
    function closeWindow(id) {
        document.getElementById(id).style.display = 'none';
    }
    
    function minimizeWindow(id) {
        closeWindow(id);
    }

    // 放大/還原功能
    function toggleMaximize(id) {
        const win = document.getElementById(id);
        win.style.zIndex = ++zIndexCounter;
        
        if (win.classList.contains('maximized')) {
            // 還原 (Restore)
            const state = windowStates[id];
            if (state) {
                win.style.width = state.width;
                win.style.height = state.height;
                win.style.top = state.top;
                win.style.left = state.left;
                win.style.transform = state.transform || 'none';
            }
            win.classList.remove('maximized');
            // 更新 SVG 圖示為最大化方框
            win.querySelector('.control-btn:nth-child(2) svg path').setAttribute('d', 'M1 1h8v8H1V1z');
        } else {
            // 儲存當前狀態
            windowStates[id] = {
                width: win.style.width || window.getComputedStyle(win).width,
                height: win.style.height || window.getComputedStyle(win).height,
                top: win.offsetTop + 'px',
                left: win.offsetLeft + 'px',
                transform: win.style.transform 
            };
            
            // 放大 (Maximize)
            win.classList.add('maximized');
            // 更新 SVG 圖示為還原 (重疊方框)
            win.querySelector('.control-btn:nth-child(2) svg path').setAttribute('d', 'M3 3h6v6H3V3z M1 5h4v4H1V5z');
        }
    }

    // 開啟新視窗函數
    function openWindow(id) {
        const win = document.getElementById(id);
        if (win) {
            win.style.display = 'flex';
            win.style.zIndex = ++zIndexCounter;
        }
    }
    
    // 開始選單切換
    function toggleStartMenu() {
        const menu = document.getElementById('start-menu-panel');
        const button = document.getElementById('start-button');
        const isShown = menu.classList.toggle('show');
        button.classList.toggle('active', isShown);
    }

    // --- 初始化 ---
    document.addEventListener('DOMContentLoaded', () => {
        // 時鐘更新
        function updateClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false });
            const dateStr = now.toLocaleDateString('zh-TW', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '/');
            document.getElementById('clock-time').innerText = timeStr;
            document.getElementById('clock-date').innerText = dateStr;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // 桌面圖示選取效果
        window.selectIcon = function(element) {
            document.querySelectorAll('.d-icon').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        }

        // 全域點擊監聽器，處理點擊外部關閉開始選單和取消圖示選取
        document.addEventListener('click', function(e) {
            const menu = document.getElementById('start-menu-panel');
            const startButton = document.getElementById('start-button');
            
            // 處理點擊外部關閉選單
            // 如果點擊的不是開始選單本身，也不是開始按鈕(或其子元素)，就關閉選單
            if (!menu.contains(e.target) && !startButton.contains(e.target)) {
                if (menu.classList.contains('show')) {
                    menu.classList.remove('show');
                    startButton.classList.remove('active');
                }
            }
            
            // 處理取消圖示選取
            if (e.target.closest('.d-icon') === null && !startButton.contains(e.target)) {
                 document.querySelectorAll('.d-icon').forEach(el => el.classList.remove('selected'));
            }
        });
        
        // 綁定開始按鈕
        document.getElementById('start-button').addEventListener('click', function(e) {
            e.stopPropagation(); // 阻止事件冒泡到 document，避免被上面的監聽器立即關閉
            toggleStartMenu();
        });

        // --- 視窗功能綁定 ---

        // 終端機：僅拖曳 (無縮放、控制按鈕無功能)
        makeDraggable(document.getElementById('terminal-window'), document.getElementById('title-bar-terminal'));
        
        // 本機：拖曳 + 縮放 + 控制
        const thisPcWindow = document.getElementById('window-this-pc');
        makeDraggable(thisPcWindow, document.getElementById('title-bar-this-pc'));
        makeResizable(thisPcWindow, document.getElementById('resize-handle-this-pc'));
        
        // 資源回收桶：拖曳 + 控制 (無縮放)
        makeDraggable(document.getElementById('window-recycle-bin'), document.getElementById('title-bar-recycle-bin'));

        // 初始狀態：儲存初始置中位置，以便還原時計算準確
        windowStates['terminal-window'] = {
            width: '80%', height: '70%', top: '50%', left: '50%', transform: 'translate(-50%, -50%)'
        };
        windowStates['window-this-pc'] = {
            width: '850px', height: '550px', top: '50%', left: '50%', transform: 'translate(-50%, -50%)'
        };
         windowStates['window-recycle-bin'] = {
            width: '600px', height: '400px', top: '50%', left: '50%', transform: 'translate(-50%, -50%)'
        };
    });
</script>
</body>
</html>
